# 极简修仙养成 MVP 模型层设计文档

## 📋 架构概述

本文档描述了极简修仙游戏的**组件化模型层架构**，采用解耦设计便于扩展：
- 🧍 **角色组件系统** - 模块化的状态管理
- 🪄 **动作系统** - 统一的动作执行接口
- 🔧 **规则引擎** - 独立的数值计算逻辑
- 📊 **经验系统** - 累积制境界晋升机制

---

## 🧍 一、角色组件系统

### 核心组件架构
```
CharacterStats
├── HealthComponent      # 生命值管理
├── ManaComponent        # 仙力值管理
├── ExperienceComponent  # 经验与境界管理
├── TalentComponent      # 资质系统
├── InventoryComponent   # 物品栏管理
└── GameLog             # 游戏日志
```

### 组件字段定义
| 组件 | 字段名 | 类型/范围 | 说明 |
| ---- | ------ | --------- | ---- |
| **基础信息** | name | 文本 | 角色名称 |
| **HealthComponent** | current_hp | 数值（0~max_hp） | 当前生命值 |
|  | max_hp | 数值（默认100） | 最大生命值 |
|  | recovery_rate | 浮点数（默认1.0） | 恢复倍率 |
| **ManaComponent** | current_mp | 数值（0~max_mp） | 当前仙力值 |
|  | max_mp | 数值（默认100） | 最大仙力值 |
|  | recovery_rate | 浮点数（默认1.0） | 恢复倍率 |
| **ExperienceComponent** | total_experience | 数值（0~∞） | 总累积经验 |
|  | current_level_experience | 数值（0~threshold） | 当前境界经验 |
|  | current_realm | RealmLevel枚举 | 当前修仙境界 |
| **TalentComponent** | base_talent | 数值（1~10） | 基础资质值 |
| **InventoryComponent** | items["pill"] | 数值（0~∞） | 丹药数量 |
| **行为统计** | meditation_streak | 数值 | 连续打坐次数 |
|  | total_actions | 数值 | 总行动次数 |

### 组件接口设计
每个组件都提供标准化的接口：
- **恢复操作**: `restore(amount)` - 恢复数值
- **消耗操作**: `consume(amount)` - 消耗数值
- **状态查询**: `is_alive()`, `get_percentage()` - 获取状态
- **边界检查**: 自动处理最大值/最小值边界

---

## 🪄 二、动作系统架构

### 动作基类设计
```python
class Action(ABC):
    - name: str           # 动作名称
    - description: str    # 动作描述

    # 核心接口
    + get_cost(): Cost           # 获取消耗
    + can_execute(): bool        # 检查可执行性
    + execute(): ActionResult    # 执行动作
```

### 具体动作实现

#### 1. 打坐 (MeditateAction)
- **前提条件**: 角色存活
- **消耗**: 生命值-1, 时间+1
- **效果**:
  - 仙力恢复: `8 + (资质 × 0.8)`
  - 经验获得: `3 + (资质 × 0.8)`
- **连续奖励**: 每5次连续打坐获得1颗丹药
- **设计理念**: 微量消耗体现修炼代价，连续奖励鼓励专注

#### 2. 服用丹药 (ConsumePillAction)
- **前提条件**: 角色存活, 丹药≥1
- **消耗**: 丹药-1
- **效果**:
  - 生命恢复: `15 + (资质 × 1.0)`
  - 仙力恢复: `15 + (资质 × 1.0)`
  - 经验获得: `5 + (资质 × 1.0)`
- **副作用**: 重置连续打坐计数
- **设计理念**: 快速恢复手段，但打断修炼节奏

#### 3. 修炼功法 (CultivateAction)
- **前提条件**: 角色存活, 仙力≥20
- **消耗**: 仙力-20, 时间+2
- **效果**:
  - 经验获得: `12 + (资质 × 1.5)`
- **副作用**: 重置连续打坐计数
- **设计理念**: 主要经验来源，资质影响最大

#### 4. 等待 (WaitAction)
- **前提条件**: 角色存活
- **消耗**: 生命值-1, 时间+1
- **效果**:
  - 生命恢复: `2 + (资质 × 0.2)`
  - 仙力恢复: `3 + (资质 × 0.2)`
- **副作用**: 重置连续打坐计数
- **设计理念**: 被动恢复，资质影响最小

---

## 🔧 三、规则引擎系统

### 数值计算规则
```python
class GameRule:
    # 基础配置
    - max_hp: 100
    - max_mp: 100
    - starting_mp_ratio: 0.5

    # 资质影响倍率
    talent_multipliers = {
        "meditate": 0.8,    # 打坐
        "cultivate": 1.5,   # 修炼
        "pill": 1.0,        # 丹药
        "wait": 0.2,        # 等待
    }
```

### 境界系统 (RealmLevel)
```python
enum RealmLevel:
    QI_REFINING = "炼气期"           # 阈值: 100
    FOUNDATION = "筑基期"            # 阈值: 200
    CORE_FORMATION = "结丹期"        # 阈值: 400
    NASCENT_SOUL = "元婴期"          # 阈值: 800
    SPIRITUAL_TRANSFORMATION = "化神期" # 阈值: 1600
    ASCENSION = "飞升"               # 阈值: ∞
```

### 经验系统特性
- **累积制**: 总经验持续累积，支持成就系统
- **境界突破**: 经验达到阈值自动突破，剩余经验转入新境界
- **进度追踪**: 提供当前境界进度百分比
- **实力评分**: 综合角色状态计算实力等级

### 难度系统
```python
DifficultySettings:
- easy: 资质(5-10), 初始丹药3, 经验倍率1.2, 恢复倍率1.3
- normal: 资质(1-10), 初始丹药1, 经验倍率1.0, 恢复倍率1.0
- hard: 资质(1-6), 初始丹药0, 经验倍率0.8, 恢复倍率0.7
```

---

## 🌀 四、状态变化逻辑链

### 核心循环机制
```
打坐恢复 → 修炼提升 → 境界突破 → 能力增强
    ↓ (每5次)      ↑           ↑
丹药奖励 ←── 消耗丹药 ←── 紧急恢复
```

### 平衡设计要点
- **资源约束**: 生命值持续消耗迫使玩家决策
- **连续奖励**: 鼓励专注单一动作获得额外收益
- **资质差异**: 不同资质玩家体验不同成长曲线
- **丹药机制**: 防止资源枯竭，提供策略选择

### 策略深度
- **高风险高回报**: 修炼消耗大但收益高
- **稳定积累**: 打坐稳定但缓慢
- **应急处理**: 丹药用于危急情况
- **节奏控制**: 连续奖励vs灵活切换

---

## 🎯 五、扩展性设计

### 预留接口
1. **时间系统**: 动作消耗时间，支持时间加速
2. **技能系统**: 动作可升级为技能，支持熟练度
3. **装备系统**: 装备影响动作效果和资质
4. **任务系统**: 事件驱动的任务进度追踪
5. **成就系统**: 基于总经验和行为统计
6. **难度系统**: 可调整的难度参数

### 组件化优势
- **模块独立**: 每个组件可独立开发和测试
- **易于扩展**: 新功能可插入现有组件
- **配置灵活**: 规则引擎支持快速平衡调整
- **AI友好**: 清晰的接口便于AI算法接入

### 扩展示例
```python
# 未来扩展示例
class SkillAction(Action):          # 技能系统
class EquipmentComponent:           # 装备系统
class QuestTracker:                 # 任务系统
class AchievementSystem:            # 成就系统
```

---

## 🧭 六、MVP特点

### 核心特性
- ✅ **组件化解耦**: 角色状态、动作、规则完全分离
- ✅ **累积经验制**: 支持长期成长和成就系统
- ✅ **资质差异化**: 1-10资质创造不同游戏体验
- ✅ **策略深度**: 资源管理创造决策需求

### 设计简约
- 🔸 **无复杂系统**: 暂不包含地图、战斗、法术等
- 🔸 **数值透明**: 所有计算公式清晰可见
- 🔸 **逻辑清晰**: 状态变化链明确易懂
- 🔸 **AI可用**: 支持机器学习算法训练

### 技术优势
- 📦 **高度模块化**: 每个组件职责单一，依赖关系清晰
- 🔧 **易于配置**: 规则引擎支持参数化调整
- 🎮 **接口标准**: 统一的动作接口便于扩展
- 📊 **状态可追踪**: 完整的日志和状态历史

---

## 📖 使用示例

### 创建角色
```python
character = CharacterStats("张三")
# 自动生成随机资质(1-10)，初始状态50%仙力
```

### 执行动作
```python
action = MeditateAction()
result = action.execute(character, game_log)
# 返回执行结果、效果、消耗等信息
```

### 状态查询
```python
status = character.get_status_summary()
# 获取完整的状态摘要，包含所有组件信息
```

这个架构设计确保了系统的可扩展性、可维护性和可测试性，为后续功能扩展奠定了坚实的基础。